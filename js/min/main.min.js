$(document).ready(function(){function o(o){y=L.geoJson(o).addTo(d)}function t(o){v=o.target.bringToFront(),v.setStyle({weight:5,color:"black"})}function e(o){var t;for(key in E)key===o.trim()&&(t=E[key].bringToFront(),t.setStyle({color:"#F7F5E8",fillOpacity:1,fillColor:"#b70101"}))}function n(o){F?T.indexOf(o.target.feature.properties.NAME)>-1?o.target.setStyle({weight:2,color:"#F7F5E8",fillOpacity:1,fillColor:"#b70101"}):geojson.resetStyle(o.target):geojson.resetStyle(o.target)}function a(o,e){e.on({mouseover:t,mouseout:n,dblclick:l,click:p})}function r(){return{fillColor:"#8A939D",weight:2,opacity:1,color:"#F7F5E8",fillOpacity:1}}function l(o){o.target;d.fitBounds(o.target.getBounds()),o.target.setStyle({weight:5,color:"black",dashArray:"",fillOpacity:1,fillColor:"yellow"})}function c(o){var t=o+".csv",e="/data/csv/"+t;Papa.parse(e,{download:!0,delimiter:",",complete:function(o){console.log(o),u(o.data[0],o.data),console.log(o)}})}function s(o){var t=$("#type").children("option").length,e=[],n=[];$("#type option").each(function(){e.push($(this).val())});for(var i=1;t>i;i++)n[i]=e[i],e[i]=g(e[i]),e[i]="/data/csv/"+e[i]+".csv",console.log(e[i]),Papa.parse(e[i],{download:!0,delimiter:",",complete:function(t){f(t.data[0],t.data,o,n,e)}})}function f(o,t,e,n,a){var r,l;for(i=1;i<t.length;i++)if(e==t[i][0].trim())for(k=1;k<o.length;k++)"TRUE"==t[i][k]&&(console.log(a[i]),r=n[k],l=o[k])}function g(o){var t=o.toLowerCase(),e=t.replace(/ /g,"_");return e}function u(o,t){var n=!1,a=!1,r=-1;for($("#county").empty(),j=0;j<t.length;j++)for(n=!1,k=0;k<t[j].length;k++)if("TRUE"==t[j][k]&&0==n){n=!0,0==a&&$("#county").append('<option value ="nothing"></option>');var l="";l='<option value="'+t[j][0]+'">'+t[j][0]+"</option>",$("#county").append(l),$("#county").trigger("chosen:updated"),r+=1,T[r]=t[j][0].trim(),e(t[j][0])}var l="";for(i=0;i<o.length;i++)l+='<option value="'+o[i]+'">'+o[i]+"</option>",w=o[i];$("#year").append(l),$("#year").trigger("chosen:updated")}function p(o){for($(".tBody").empty(),s(o.target.feature.properties.NAME),j=0;j<b.length;j++)for(bool=!1,k=0;k<b[j].length;k++)"TRUE"==b[j][k]&&0==bool&&(bool=!0,index+=1,T[index]=b[j][0].trim(),e(b[j][0]));for(console.log(w+" "+b),i=1;i<w.length;i++);}var d,h,y,m,v,b,w,E=[],T=[],F=!1;m=screen.height,$(".chosen-select").chosen(),$("#dataTable").tablesorter(),$("#reset").click(function(){history.go(0)}),d=L.map("map",{center:[44.7,-90],zoom:7,minZoom:6,maxZoom:9}),d.setMaxBounds([[49,-85],[42,-94]]),h=L.tileLayer("http://{s}.acetate.geoiq.com/tiles/acetate/{z}/{x}/{y}.png",{attribution:"Acetate tileset from GeoIQ Data from wikipedia"}).addTo(d),$.getJSON("data/WI_Counties_geojson.geojson").done(function(t){o(t),geojson=L.geoJson(t,{onEachFeature:a,style:r}).addTo(d);var e=geojson._layers;for(key in e){var n=e[key].feature.properties.NAME;E[n]=e[key]}}).fail(function(){alert("There was a problem loading data")}),$(function(){$("input#search_button").click(function(){F=!0;var o,t;$("#county_chosen").find(".chosen-single").each(function(){o=$(this).find("span").text()}),$("#type_chosen").find(".chosen-single").each(function(){t=$(this).find("span").text()}),console.log(o);var n=g(t);c(n),e(o),T[0]=o.trim()})})});