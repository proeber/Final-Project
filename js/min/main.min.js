$(document).ready(function(){function t(t){y=L.geoJson(t).addTo(p)}function o(t){m=t.target.bringToFront(),m.setStyle({weight:5,color:"black"})}function e(t){var o;for(key in b)key===t.trim()&&(o=b[key].bringToFront(),o.setStyle({color:"#F7F5E8",fillOpacity:1,fillColor:"#b70101"}))}function n(t){E?w.indexOf(t.target.feature.properties.NAME)>-1?t.target.setStyle({weight:2,color:"#F7F5E8",fillOpacity:1,fillColor:"#b70101"}):geojson.resetStyle(t.target):geojson.resetStyle(t.target)}function a(t,e){e.on({mouseover:o,mouseout:n,dblclick:l,click:u})}function r(){return{fillColor:"#8A939D",weight:2,opacity:1,color:"#F7F5E8",fillOpacity:1}}function l(t){t.target;p.fitBounds(t.target.getBounds()),t.target.setStyle({weight:5,color:"black",dashArray:"",fillOpacity:1,fillColor:"yellow"})}function c(t){var o=t+".csv",e="/data/csv/"+o;Papa.parse(e,{download:!0,delimiter:",",complete:function(t){console.log(t),g(t.data[0],t.data),console.log(t)}})}function s(){var t=$("#type").children("option").length,o=[],e=[];$("#type option").each(function(){o.push($(this).val())});for(var n=0,a=1;t>a;a++)e[a]=o[a],o[a]=f(o[a]),o[a]="/data/csv/"+o[a]+".csv",console.log(o[a]),Papa.parse(o[a],{download:!0,delimiter:",",complete:function(t){var o=t.data[0],i=t.data,r=r,l=e;console.log("tessst");var c,s;for(a=1;a<i.length;a++)if(r==i[a][0].trim())for(console.log("tttttt"),k=1;k<o.length;k++)console.log(r+" "+i[a][0].trim()),"TRUE"==i[a][k]&&(c=l[k],s=o[k],console.log(s+" "+c));n++}})}function f(t){var o=t.toLowerCase(),e=o.replace(/ /g,"_");return e}function g(t,o){var n=!1,a=!1,r=-1;for($("#county").empty(),j=0;j<o.length;j++)for(n=!1,k=0;k<o[j].length;k++)if("TRUE"==o[j][k]&&0==n){n=!0,0==a&&$("#county").append('<option value ="nothing"></option>');var l="";l='<option value="'+o[j][0]+'">'+o[j][0]+"</option>",$("#county").append(l),$("#county").trigger("chosen:updated"),r+=1,w[r]=o[j][0].trim(),e(o[j][0])}var l="";for(i=0;i<t.length;i++)l+='<option value="'+t[i]+'">'+t[i]+"</option>",v=t[i];$("#year").append(l),$("#year").trigger("chosen:updated")}function u(t){$(".tBody").empty(),s(t.target.feature.properties.NAME)}var p,d,y,h,m,v,b=[],w=[],E=!1;h=screen.height,$(".chosen-select").chosen(),$("#dataTable").tablesorter(),$("#reset").click(function(){history.go(0)}),p=L.map("map",{center:[44.7,-90],zoom:7,minZoom:6,maxZoom:9}),p.setMaxBounds([[49,-85],[42,-94]]),d=L.tileLayer("http://{s}.acetate.geoiq.com/tiles/acetate/{z}/{x}/{y}.png",{attribution:"Acetate tileset from GeoIQ Data from wikipedia"}).addTo(p),$.getJSON("data/WI_Counties_geojson.geojson").done(function(o){t(o),geojson=L.geoJson(o,{onEachFeature:a,style:r}).addTo(p);var e=geojson._layers;for(key in e){var n=e[key].feature.properties.NAME;b[n]=e[key]}}).fail(function(){alert("There was a problem loading data")}),$(function(){$("input#search_button").click(function(){E=!0;var t,o;$("#county_chosen").find(".chosen-single").each(function(){t=$(this).find("span").text()}),$("#type_chosen").find(".chosen-single").each(function(){o=$(this).find("span").text()}),console.log(t);var n=f(o);c(n),e(t),w[0]=t.trim()})})});