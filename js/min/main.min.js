$(document).ready(function(){function e(e){d=L.geoJson(e).addTo(g)}function t(e){var t=e.target;t.setStyle({weight:5,color:"black",dashArray:"",fillOpacity:1,fillColor:"green"})}function o(e){var t;for(key in p)key===e.trim()&&(t=p[key],console.log(t),t.setStyle({weight:5,color:"black",dashArray:"",fillOpacity:1,fillColor:"yellow"}))}function a(e){if(m)for(var t=0;t<h.length;t++)e.target.feature.properties.NAME==h[t].trim()?(console.log(e.target.feature.properties.NAME,h[t]),e.target.setStyle({weight:5,color:"black",dashArray:"",fillOpacity:1,fillColor:"yellow"})):geojson.resetStyle(e.target);else console.log(t),geojson.resetStyle(e.target)}function n(e,o){o.on({mouseover:t,mouseout:a,dblclick:l})}function r(){return{fillColor:"red",weight:2,opacity:1,color:"white",dashArray:"3",fillOpacity:1}}function l(e){e.target;g.fitBounds(e.target.getBounds()),e.target.setStyle({weight:5,color:"black",dashArray:"",fillOpacity:1,fillColor:"yellow"})}function c(e){var t=e+".csv",o="/data/csv/"+t;Papa.parse(o,{download:!0,delimiter:",",complete:function(e){f(e.data[0],e.data)}})}function s(e){var t=e.toLowerCase(),o=t.replace(/ /g,"_");return o}function f(e,t){var a=!1,n=-1;for($("#county").empty(),j=1;j<t.length;j++)for(a=!1,k=0;k<t[j].length;k++)if("TRUE"==t[j][k]&&0==a){a=!0;var r="";r='<option value="'+t[j][0]+'">'+t[j][0]+"</option>",$("#county").append(r),$("#county").trigger("chosen:updated"),n+=1,console.log(t[j][0]),h[n]=t[j][0].trim(),o(t[j][0])}var r="";for(i=1;i<e.length;i++)r+='<option value="'+e[i]+'">'+e[i]+"</option>";$("#year").append(r),$("#year").trigger("chosen:updated")}var g,u,d,y,p=[],h=[],m=!1;y=screen.height,$(".chosen-select").chosen(),$("#dataTable").tablesorter(),$("#reset").click(function(){history.go(0)}),g=L.map("map",{center:[44.7,-90],zoom:7,minZoom:7}),g.setMaxBounds([[49,-85],[42,-94]]),u=L.tileLayer("http://{s}.acetate.geoiq.com/tiles/acetate/{z}/{x}/{y}.png",{attribution:"Acetate tileset from GeoIQ Data from Wikipedia"}).addTo(g),$.getJSON("data/WI_Counties_geojson.geojson").done(function(t){e(t),geojson=L.geoJson(t,{onEachFeature:n,style:r}).addTo(g);var o=geojson._layers;for(key in o){var a=o[key].feature.properties.NAME;p[a]=o[key]}}).fail(function(){alert("There was a problem loading data")}),$(function(){$("input#search_button").click(function(){m=!0;var e,t;$("#county_chosen").find(".chosen-single").each(function(){e=$(this).find("span").text()}),$("#type_chosen").find(".chosen-single").each(function(){t=$(this).find("span").text()}),console.log(e);var o=s(t);c(o)})})});