$(document).ready(function(){function e(e){d=L.geoJson(e).addTo(u)}function o(e){h=e.target,h.setStyle({weight:5,color:"black",dashArray:"",fillOpacity:1,fillColor:"green"})}function t(e){var o;for(key in m)key===e.trim()&&(o=m[key],console.log(o),o.setStyle({weight:5,color:"black",dashArray:"",fillOpacity:1,fillColor:"yellow"}))}function n(e){if(w)for(var o=0;o<v.length;o++)e.target.feature.properties.NAME==v[o].trim()?(console.log(e.target.feature.properties.NAME,v[o]),e.target.setStyle({weight:5,color:"black",dashArray:"",fillOpacity:1,fillColor:"yellow"})):geojson.resetStyle(e.target);else console.log(o),geojson.resetStyle(e.target)}function a(e,t){t.on({mouseover:o,mouseout:n,dblclick:l}),t.on("click",function(){g()})}function r(){return{fillColor:"red",weight:2,opacity:1,color:"white",dashArray:"3",fillOpacity:1}}function l(e){e.target;u.fitBounds(e.target.getBounds()),e.target.setStyle({weight:5,color:"black",dashArray:"",fillOpacity:1,fillColor:"yellow"})}function c(e){var o=e+".csv",t="/data/csv/"+o;Papa.parse(t,{download:!0,delimiter:",",complete:function(e){f(e.data[0],e.data)}})}function s(e){var o=e.toLowerCase(),t=o.replace(/ /g,"_");return t}function f(e,o){var n=!1,a=-1;for($("#county").empty(),j=1;j<o.length;j++)for(n=!1,k=0;k<o[j].length;k++)if("TRUE"==o[j][k]&&0==n){n=!0;var r="";r='<option value="'+o[j][0]+'">'+o[j][0]+"</option>",$("#county").append(r),$("#county").trigger("chosen:updated"),a+=1,console.log(o[j][0]),v[a]=o[j][0].trim(),t(o[j][0])}var r="";for(i=1;i<e.length;i++)r+='<option value="'+e[i]+'">'+e[i]+"</option>";$("#year").append(r),$("#year").trigger("chosen:updated")}function g(e){h.on("click",function(o){for(console.log(o.target.feature.properties.NAME),$(".tBody").empty(),i=1;i<e.length;i++)console.log(e.length)})}var u,y,d,p,h,m=[],v=[],w=!1;p=screen.height,$(".chosen-select").chosen(),$("#dataTable").tablesorter(),$("#reset").click(function(){history.go(0)}),u=L.map("map",{center:[44.7,-90],zoom:7,minZoom:7}),u.setMaxBounds([[49,-85],[42,-94]]),y=L.tileLayer("http://{s}.acetate.geoiq.com/tiles/acetate/{z}/{x}/{y}.png",{attribution:"Acetate tileset from GeoIQ Data from Wikipedia"}).addTo(u),$.getJSON("data/WI_Counties_geojson.geojson").done(function(o){e(o),geojson=L.geoJson(o,{onEachFeature:a,style:r}).addTo(u);var t=geojson._layers;for(key in t){var n=t[key].feature.properties.NAME;m[n]=t[key]}}).fail(function(){alert("There was a problem loading data")}),$(function(){$("input#search_button").click(function(){w=!0;var e,o;$("#county_chosen").find(".chosen-single").each(function(){e=$(this).find("span").text()}),$("#type_chosen").find(".chosen-single").each(function(){o=$(this).find("span").text()}),console.log(e);var t=s(o);c(t)})})});